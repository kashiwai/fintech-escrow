# 🏦 完全な銀行エスクロー入金→USDT送金フロー

## 🌐 アクセス情報

**メイン画面**: http://localhost:6005/
**入金データ生成**: [indata.html](file:///Users/kotarokashiwai/fintech/indata.html)

## 📋 正しい運用フロー

### 1. 入金データ生成（銀行入金シミュレーション）

**手順**:
1. `indata.html` をブラウザで開く
2. 「クイック生成」で複数入金を一括生成、または個別入金作成
3. 送金者名、金額、銀行、目的を設定
4. データが自動的にエスクローシステムに送信される

**生成される情報**:
- 送金者名（個人・法人）
- 送金額（10万円〜5000万円）
- 送金元銀行
- 送金目的
- 受信時刻

### 2. 入金確認・選択（メイン業務画面）

**アクセス**: http://localhost:6005/deposits

**機能**:
- 銀行入金一覧表示
- フィルター機能（未処理/処理中/完了/本日分）
- リアルタイム更新（10秒ごと）
- 統計情報表示

**画面表示内容**:
- ✅ 送金者名・送金元銀行
- ✅ 入金額（日本円）
- ✅ 送金目的
- ✅ 受信時刻
- ✅ 処理状況

### 3. USDT変換承認

**手順**:
1. 入金一覧から対象を選択
2. 「💱 USDT変換承認」ボタンクリック
3. 承認モーダルが表示される

**表示内容**:
- 現在の為替レート（JPY/USDT）
- 変換計算詳細
  - 入金額（JPY）
  - 変換前USDT
  - 処理手数料（0.5%）
  - ネットワーク手数料（1 USDT）
  - **受取額（USDT）**
- レート有効期限（5分間カウントダウン）

### 4. TRON送金先アドレス入力

**要件**:
- TRONアドレス形式（T + 33文字）
- 例: `TLsV52sRDL79HXGGm9yzwKiVegTCjCWbPL`

### 5. 承認・実行

**処理内容**:
1. ✅ 承認ボタンクリック
2. 🔄 USDT変換実行
3. 📤 TRON送金開始
4. 🆔 TXID生成・表示
5. ⏳ ステータス「送金中」に変更
6. ✅ 5秒後「完了」に自動変更

### 6. 送金確認

**確認方法**:
- 🔍 「送金状況確認」ボタン
- TronScanで自動確認
- リアルタイムステータス更新

## 🎯 完全デモフロー

### シナリオ1: 個人からの少額送金
```
1. indata.html で個人名「田中太郎」1,000,000円を生成
2. 入金確認画面で選択・承認
3. レート150円/USDT、手数料計算
4. TRONアドレス入力・送金実行
5. 受取額: 約6.6 USDT
```

### シナリオ2: 法人からの大口送金
```
1. indata.html で法人名「テックソリューション」10,000,000円を生成
2. 入金確認画面で選択・承認
3. レート計算・大口取引表示
4. TRONアドレス入力・送金実行
5. 受取額: 約66 USDT
```

### シナリオ3: 複数同時処理
```
1. indata.html で「通常日(20-30件)」クリック
2. 30件の入金データ自動生成
3. 入金確認画面で複数件を順次処理
4. 各件のTRONアドレス入力・承認
5. 全件完了まで管理
```

## 🔄 リアルタイム機能

### 自動更新
- **入金一覧**: 10秒ごと
- **為替レート**: 1分ごと
- **ステータス**: リアルタイム

### レート管理
- 5分間有効レート
- カウントダウン表示
- 期限切れ時自動更新

### ステータス遷移
1. `pending` → 未処理
2. `processing` → 送金中
3. `completed` → 完了

## 🚀 実際の使用手順

1. **入金データ準備**
   `indata.html` で本日の入金データを生成

2. **メイン画面確認**
   http://localhost:6005/ で統計確認

3. **入金処理開始**
   総残高カードクリック → 入金確認画面

4. **順次承認処理**
   各入金を選択 → USDT変換 → TRON送金

5. **完了確認**
   全件処理完了まで管理

## ⚡ トラブルシューティング

### よくある問題
- **TRONアドレスエラー**: T+33文字の正しい形式を確認
- **レート期限切れ**: 5分以内に処理完了
- **ステータス更新されない**: ページ更新で解決

### データリセット
```bash
# 完全リセット
rm -f fintech.db audit.log
python3 -c "from src.app.db import init_db; init_db()"
```

---

**システムは http://localhost:6005/ で稼働中**
**入金生成は indata.html から実行**