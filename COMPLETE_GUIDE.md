# 🏦 銀行エスクロー管理システム 完全ガイド

## 🌐 アクセス情報

### メイン管理画面
**URL**: http://localhost:6005/

ポート6005でWebサーバーが起動しています。

## 📱 各種画面説明

### 1. メインダッシュボード
**URL**: http://localhost:6005/
- 総残高表示
- 未処理入金数
- 承認待ち件数
- 現在の為替レート（リアルタイム更新）

### 2. 💰 入金確認画面
**URL**: http://localhost:6005/deposits

**機能**:
- バーチャルアカウントへの入金検知
- 入金額と送金元の確認
- 入金承認処理
- 5秒ごとの自動更新

**フロー**:
1. 入金を検知（自動）
2. 金額と送金元を確認
3. 「確認」ボタンで承認
4. 承認後、USDT変換可能

### 3. 💱 通貨変換画面
**URL**: http://localhost:6005/convert

**表示内容**:
- 現在の為替レート（JPY/USDT）
- ネットワーク手数料
- 処理手数料（0.5%）
- レート有効期限（5分間カウントダウン）

**計算機能**:
- JPY入力で自動計算
- 手数料込みの受取額表示
- チェーン選択（TRC20/ERC20）
- リアルタイム見積もり

### 4. ✅ 承認管理画面
**URL**: http://localhost:6005/approvals

**機能**:
- 承認待ち取引一覧
- 承認進捗バー表示
- 複数承認者管理
- 大口取引アラート（赤枠表示）

**承認フロー**:
- 少額（500万円未満）: 1名承認
- 大口（500万円以上）: 2名承認必須

### 5. ⚠️ エラーログ画面
**URL**: http://localhost:6005/errors

**表示内容**:
- エラータイプ別フィルター
- 期間フィルター
- 解決/未解決ステータス
- エラー詳細JSON表示

### 6. 🎮 デモ・実験画面
**URL**: http://localhost:6005/demo

**テスト機能**:
- 入金シミュレーション
- シナリオテスト
  - 少額取引（承認不要）
  - 大口取引（2名承認）
  - エラーケース
  - 完全フロー
- DBリセット
- テストデータ生成
- リアルタイムログ表示

## 🚀 Sandboxデモ実行方法

### 基本的なデモフロー

1. **デモ画面を開く**
   ```
   http://localhost:6005/demo
   ```

2. **入金シミュレーション**
   - Client選択（A or B）
   - 金額入力（例: 1,000,000円）
   - 「入金実行」クリック

3. **入金確認**
   - http://localhost:6005/deposits へ移動
   - 入金を確認して「確認」ボタン

4. **通貨変換**
   - http://localhost:6005/convert へ移動
   - JPY金額入力
   - 送金先アドレス入力
   - 「変換を実行」クリック

5. **承認処理**
   - http://localhost:6005/approvals へ移動
   - 承認者名入力
   - 「承認」ボタンクリック
   - 大口の場合は2人目も承認

### シナリオテスト

#### 少額取引テスト
```
1. デモ画面で「少額取引」カード選択
2. 100,000円が自動入金
3. 承認不要で自動処理
```

#### 大口取引テスト
```
1. デモ画面で「大口取引」カード選択
2. 15,000,000円が自動入金
3. 承認画面で2名の承認必要
```

#### エラーケーステスト
```
1. デモ画面で「エラーケース」カード選択
2. 残高不足エラーが発生
3. エラーログ画面で確認可能
```

#### 完全フローテスト
```
1. デモ画面で「完全フロー」カード選択
2. 入金→変換→承認→出金の全工程実行
3. 各画面で状態確認
```

## 🛠️ コマンドライン操作

### サーバー起動
```bash
# Webサーバー起動（ポート6005）
python3 -m src.app.web_server 6005
```

### データベース操作
```bash
# DB初期化
python -m src.app.simulate init

# テストデータ生成
python -m src.app.run_all
```

### 手動入金シミュレーション
```bash
python -m src.app.simulate deposit --client A --amount 5000000
```

### ダッシュボード再生成
```bash
python -m src.app.dashboard build
```

## 📊 データ確認方法

### データベース直接確認
```bash
# 残高確認
sqlite3 fintech.db "SELECT * FROM balances;"

# 取引履歴
sqlite3 fintech.db "SELECT * FROM release_requests ORDER BY created_at DESC LIMIT 10;"

# 承認状況
sqlite3 fintech.db "SELECT * FROM approvals;"
```

### ログ確認
```bash
# 監査ログ
tail -f audit.log

# エラーログ（画面から確認推奨）
http://localhost:6005/errors
```

## 🔧 トラブルシューティング

### Webサーバーが起動しない
```bash
# プロセス確認
lsof -i :6005

# 別ポートで起動
python3 -m src.app.web_server 6006
```

### データベースエラー
```bash
# DB完全リセット
rm -f fintech.db audit.log
python -m src.app.simulate init
```

### 画面が更新されない
- ブラウザのキャッシュクリア
- F5でリロード
- 自動更新は5-10秒間隔

## 📝 注意事項

1. **Sandbox環境**
   - 実際の送金は行われません
   - レートは±0.5%でランダム変動
   - MCPとの連携はモックモード

2. **承認ルール**
   - 500万円未満: 1名承認
   - 500万円以上: 2名承認必須
   - 承認後のキャンセル不可

3. **レート有効期限**
   - 5分間有効
   - 期限切れ後は自動更新
   - 変換実行時に最新レート使用

## 🎯 デモのポイント

1. **リアルタイム更新**
   - 為替レートは1分ごと
   - 入金確認は5秒ごと
   - 承認画面は10秒ごと

2. **エラー処理**
   - ネットワークエラー
   - 残高不足
   - レート期限切れ
   - 承認却下

3. **セキュリティ**
   - 2段階承認
   - 監査ログ（改ざん防止）
   - アドレスホワイトリスト

## 📞 サポート

問題が発生した場合:
1. エラーログ画面を確認
2. audit.logをチェック
3. DBリセットで初期化
4. サーバー再起動

---
システムは http://localhost:6005/ で稼働中です。
各画面をブラウザで開いてご確認ください。